<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../imgs/logoApoena.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apoena | Avisos</title>

    <script src="../js/funcoes.js"></script>

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="./dashboards.css">

    <script type='text/javascript' src='https://widget.freshworks.com/widgets/72000000689.js' async defer></script>

    <!-- 
        href="../assets/icon/favicon.ico"
        <script src="../js/funcoes.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    -->
</head>

<body onload="validarSessao()" style="background-color: #161618;">


        <div class="janela">
            <div class="header-left">
                <h1>Apoena</h1>
    
                <div class="hello">
                    <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
                </div>
    
                <div class="btn-nav-white">
                    <a href="./cards.html">
                        <h3>Seus Caminhões</h3>
                    </a>
                </div>
    
                <div class="btn-nav-white">
                    <a href="dashboard.html">
                        <h3>Relatorio de viagens</h3>
                    </a>
                </div>
    
                <div class="btn-nav">
                    <a href="./mural.html">
                        <h3>Gerenciar viagens</h3>
                    </a>
                </div>
                <div  class="btn-nav">
                   <button class="btnproduto" onclick="produtos()"> Produtos Cadastrados </button>
                </div>
    
                <div class="btn-logout" onclick="limparSessao()">
                    <h3>Sair</h3>
                </div>
    

        </div>

        <div class="dash-right">

            <div class="avisos">
                <div class="container">
                    <h1>Cadastrar caminhão</h1>
                    <div class="div-form">
                        
                            <label>
                                <h3>Cadastre seu caminhão:</h3>
                                Placa: <input name="titulo" id="in_placa" maxlength="8" type="text" placeholder="AAA-0000" disabled>
                            </label>
                            <br>
                            <label>
                                <h3>Inicie sua viagem</h3>
                                Nome do produto: <input name="nome_prod" id="nome_prod" maxlength="45" type="text" placeholder="Morango, Leite..." disabled>
                                <br>
                                <br>
                                Placa do caminhão 
                                que realizara a viagem: <input name="placaviagem" id="placaviagem" maxlength="45" type="text" placeholder="Fruta, Laticínio..." disabled> 
                                <br>
                                 <br>
                                Data de inicio: <input name="dt_inicio" id="dt_inicio" maxlength="45" type="date" placeholder="2021-11-29" disabled>
                            </label>
                            <br>
                            <label>
                                <h3>Finalize sua viagem</h3>
                               numero de identificação da viagem 
                               <input type="text" id="id_viagem" placeholder="viagem que voce já realizou"
                               disabled>
                                Data de chegada: <input name="titulo" id="dt_chegada" maxlength="45" type="date"
                                placeholder="2021-11-04" disabled>
                            </label>
                            <br>
                            <br>
                            <div class="div_botoes_cadastro">
                            <button onclick="cadastrar_caminhaotela()">Cadastre seu Caminhão</button>
                            <button onclick="iniciar_viagem()">Inciar viagem</button>
                            <button onclick="finalizar_viagem()">Finalizar viagem</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>




            <!-- create table caminhao(
    idcaminhao int primary key auto_increment,
    placa char(8),
    fkempresa int
    ) auto_increment = 100;

    create table produto(
    idproduto int primary key auto_increment,
    nome varchar(45),
    placaviagem varchar(45),
    tempmax decimal(4,2),
    tempmin decimal(4,2)
    ) auto_increment = 300;
   
    create table viagem (
    idviagem int primary key auto_increment,
    datainicio date,
    datafim date,
    fkproduto int,
    fkcaminhao int
    ) auto_increment = 400; -->

        </div>
    </div>





</body>

</html>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    // variaves para mudar o disabled das inputs
    var lista_frutas=[]
    var cheque_produto= false;
    var cheque_caminhao= false;
    var cheque_viagem= false;
    function cadastrar_caminhaotela() {
    
        var placa = document.querySelector("#in_placa");
        var produto = document.querySelector("#nome_prod");
        var placaviagem = document.querySelector("#placaviagem");
        var inicio_viagem = document.querySelector("#dt_inicio");
        var fim_viagem = document.querySelector("#dt_chegada");
        if(cheque_caminhao==false){
        placa.disabled = false;
        produto.disabled = true;
        placaviagem.disabled = true;
        inicio_viagem.disabled = true;
        fim_viagem.disabled = true;
        cheque_caminhao=true;}
        else if(in_placa.value.length==7 ){
            cadastrar_caminhao();
            alert(`Caminhão ${in_placa.value} cadastrado com sucesso`)
            placa.disabled=true
            cheque_caminhao= false
            placa.value= ''}
            else if(in_placa.value.length< 7 && in_placa.value.length >1 ){
                alert(`a placa precisa ter  7 digitos`)
                cheque_caminhao = false
        }else if(in_placa.value.length >7 ){
            alert(`a placa precisa  ter 7 digitos`)

        }else{
            placa.disabled = true;
            cheque_caminhao=false;
        }
    }


    function iniciar_viagem() {
        var nome = nome_prod.value
        var viagem_placa= placaviagem.value
        var iviagem = dt_inicio.value

        var placa = document.querySelector("#in_placa");
        var produto = document.querySelector("#nome_prod");
        // var placaviagem = document.querySelector("#placaviagem");
        var inicio_viagem = document.querySelector("#dt_inicio");
        var fim_viagem = document.querySelector("#dt_chegada");
        placa.disabled = true;
        produto.disabled = false;
        placaviagem.disabled = false;
        inicio_viagem.disabled = false;
        fim_viagem.disabled = true;
        
        if(cheque_produto== false){
            placa.disabled = true;
            produto.disabled = false;
            placaviagem.disabled = false;
            inicio_viagem.disabled = false;
            fim_viagem.disabled = true;
             cheque_produto= true;
        }
     
        
        
        else {
            produto.disabled= true;
            placaviagem.disabled= true;
            inicio_viagem.disabled= true;
            cheque_produto = false;
            cadastrar_viagem()
            alert(`produto cadastrado`)


        }
        
       
    }




    function finalizar_viagem() {
        var idviagem= id_viagem.value
        var inicio = dt_inicio.value
        var fim = dt_chegada.value
        var placa = document.querySelector("#in_placa");
        var produto = document.querySelector("#nome_prod");
        var placaviagem = document.querySelector("#placaviagem");
        var inicio_viagem = document.querySelector("#dt_inicio");
        var fim_viagem = document.querySelector("#dt_chegada");

        if(cheque_viagem==false){
        id_viagem.disabled= false
        placa.disabled = true;
        produto.disabled = true;
        placaviagem.disabled = true;
        inicio_viagem.disabled = true;
        fim_viagem.disabled = false;
        cheque_viagem=true;
    }
    else if(inicio.indexOf("/") > -1 || fim.indexOf("/")> -1 ){
    alert(`não insira "/" nas datas utilize traços(-) ` )
    }
    else{
        fim_viagem.disabled = true;
        id_viagem.disabled= true
        fim_da_viagem()
        cheque_viagem=false;
        alert(` viagem finalizada com sucesso`)
        
    }
}
function cadastrar_caminhao() {
        // aguardar();

        // var formulario = new URLSearchParams(new FormData(document.getElementById("form_cadastro")));

        
        var placa= in_placa.value
        var fkempresa = sessionStorage.getItem("FKEMPRESA");
      
        fetch("/usuarios/cadastrar_caminhao", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                placa: placa,
                fkempresa: fkempresa,
                
                

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                // window.alert("Cadastro realizado com sucesso!");
                // window.location = "mural.html";
                // finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            // finalizarAguardar();
        });
    }
    function cadastrar_viagem() {
        var inicioviagem = dt_inicio.value
        var nomeproduto = nome_prod.value
        var placaviagem1=  placaviagem.value

        fetch("/usuarios/cadastrar_viagem", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                inicioviagem:inicioviagem,
                nomeproduto:nomeproduto,
                placaviagem:placaviagem1,
                
                

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);


            if (resposta.ok) {
                window.alert("Cadastro da viagem realizado com sucesso!");
                // window.location = "mural.html";
                // finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro da viagem!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            // finalizarAguardar();
        });


    
    }
    function fim_da_viagem(){
        var idviagem= id_viagem.value
        var fim_viagem= dt_chegada.value

        fetch("/usuarios/fim_da_viagem", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idviagem: idviagem,
                fim_viagem: fim_viagem,                

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);


            if (resposta.ok) {
                window.alert("Viagem finalizada com sucesso!");
                // window.location = "mural.html";
                // finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar finalizar a viagem!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            // finalizarAguardar();
        });


    
    }   
    

</script>

<script>
    // HELP DESK ----------------------------------- //
  
        window.fwSettings={
        'widget_id':72000000689
        };
        !function(){if("function"!=typeof window.FreshworksWidget){var n=function(){n.q.push(arguments)};n.q=[],window.FreshworksWidget=n}}()  
  
    //-----------------------------------------------//
    </script>